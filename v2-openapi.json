openapi: 3.1.0
info:
  title: 模型管理API
  description: 本API文档提供了对模型管理接口的详细说明，包括新版本和旧版本接口的功能、请求示例、参数说明及响应格式。
  version: "1.0.0"
  contact:
    name: Aihubmix
    url: https://aihubmix.com
servers:
  - url: https://aihubmix.com/api/v1
    description: 主生产环境

paths:
  /models:
    get:
      summary: 获取模型信息平台
      description: 获取所有可用模型的详细信息，支持多种筛选和排序方式。
      tags:
        - 新版本接口
      parameters:
        - name: type
          in: query
          description: 模型类型筛选。支持值：`llm`、`image_generation`、`video`、`tts`、`stt`、`embedding`、`rerank`
          schema:
            type: string
        - name: modalities
          in: query
          description: 输入模态筛选。支持值：`text`、`image`、`audio`、`video`、`pdf`，支持多模态查询（逗号分隔）
          schema:
            type: string
        - name: model
          in: query
          description: 模型名称模糊搜索（支持部分匹配）
          schema:
            type: string
        - name: features
          in: query
          description: >
            功能特性筛选。支持值：
            - `thinking`：支持思考推理  
            - `tools`：支持工具调用  
            - `function_calling`：支持函数调用  
            - `web`：支持搜索  
            - `deepsearch`：支持深度搜索  
            - `long_context`：长上下文模型  
            - `structured_outputs`：结构化输出  
            支持多功能查询（逗号分隔）
          schema:
            type: string
        - name: sort_by
          in: query
          description: >
            排序字段，支持：
            - `model_ratio`：按性价比排序  
            - `context_length`：按上下文长度排序  
            - `coding`：编程模型优先排序  
            - `order`：按默认顺序排序
          schema:
            type: string
        - name: sort_order
          in: query
          description: 排序方向，支持 `asc` 或 `desc`
          schema:
            type: string
            enum: [asc, desc]
      responses:
        '200':
          description: 成功响应
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: 请求执行状态
                  message:
                    type: string
                    description: 响应消息，成功时通常为空字符串
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ModelInfo'
              examples:
                example-1:
                  summary: 成功返回示例
                  value:
                    success: true
                    message: ""
                    data:
                      - model_id: "gpt-5"
                        desc: "GPT-5 is OpenAI flagship model for coding, reasoning, and agentic tasks across domains."
                        pricing:
                          cache_read: 0.125
                          input: 1.25
                          output: 10
                        types: "llm"
                        features: "thinking,tools,function_calling,structured_outputs"
                        input_modalities: "text,image"
                        max_output: 0
                        context_length: 0
        '400':
          description: 请求参数错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "请求参数格式错误"
        '500':
          description: 服务器内部错误
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                message: "服务器内部错误，请稍后重试"

  /v1/models:
    get:
      summary: 获取模型列表（旧版本接口）
      description: >
        有用户登录时获取用户分组下的可用模型列表；无用户登录时获取 default 分组下的可用列表。  
        Header 中如包含 Authorization 字段，则查询对应 token 下配置的模型列表。
      tags:
        - 旧版本接口
      security:
        - bearerAuth: []
      responses:
        '200':
          description: 成功返回模型列表
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/OldModelInfo'
              example:
                data:
                  - id: "gpt-4o-mini"
                    object: "model"
                    created: 1626777600
                    owned_by: "OpenAI"
                    permission:
                      - id: "modelperm-LwHkVFn8AcMItP432fKKDIKJ"
                        object: "model_permission"
                        created: 1626777600
                        allow_create_engine: true
                        allow_sampling: true
                        allow_logprobs: true
                        allow_search_indices: false
                        allow_view: true
                        allow_fine_tuning: false
                        organization: "*"
                        group: null
                        is_blocking: false
                    root: "gpt-4o-mini"
                    parent: null

  /v1/models/{model}:
    get:
      summary: 获取模型信息（旧版本接口）
      tags:
        - 旧版本接口
      parameters:
        - name: model
          in: path
          required: true
          description: 模型ID
          schema:
            type: string
      responses:
        '200':
          description: 成功返回模型信息
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OldModelInfo'
              example:
                id: "gpt-4o-mini"
                object: "model"
                created: 1626777600
                owned_by: "OpenAI"
                permission:
                  - id: "perm-001"
                    object: "model_permission"
                    created: 1626777600
                    allow_create_engine: true
                    allow_sampling: true
                    allow_logprobs: true
                    allow_search_indices: true
                    allow_view: true
                    allow_fine_tuning: false
                    organization: "*"
                    group: null
                    is_blocking: false
                root: "gpt-4o-mini"
                parent: null

components:
  schemas:
    ModelInfo:
      type: object
      properties:
        model_id:
          type: string
          description: 模型唯一标识符
        desc:
          type: string
          description: 模型功能描述（英文）
        types:
          type: string
          description: 模型类型
        features:
          type: string
          description: 支持的功能特性
        input_modalities:
          type: string
          description: 支持的输入模态
        max_output:
          type: integer
          description: 最大输出Token数量
        context_length:
          type: integer
          description: 上下文窗口大小
        pricing:
          type: object
          properties:
            input:
              type: number
              description: 输入Token价格（每1K Token，美元）
            output:
              type: number
              description: 输出Token价格（每1K Token，美元）
            cache_read:
              type: number
              nullable: true
              description: 缓存读取价格（每1K Token，美元）
            cache_write:
              type: number
              nullable: true
              description: 缓存写入价格（每1K Token，美元）
    OldModelInfo:
      type: object
      properties:
        id:
          type: string
          description: 模型ID
        object:
          type: string
          description: 对象类型（通常为"model"）
        created:
          type: integer
          description: 创建时间戳
        owned_by:
          type: string
          description: 开发者
        permission:
          type: array
          items:
            $ref: '#/components/schemas/ModelPermission'
        root:
          type: string
          description: 模型名称
        parent:
          nullable: true
          description: 父节点
    ModelPermission:
      type: object
      properties:
        id:
          type: string
        object:
          type: string
        created:
          type: integer
        allow_create_engine:
          type: boolean
        allow_sampling:
          type: boolean
        allow_logprobs:
          type: boolean
        allow_search_indices:
          type: boolean
        allow_view:
          type: boolean
        allow_fine_tuning:
          type: boolean
        organization:
          type: string
        group:
          nullable: true
        is_blocking:
          type: boolean
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
